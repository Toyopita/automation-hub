---
marp: true
theme: default
paginate: true
backgroundColor: #fff
---

# 効果的なコンテキストエンジニアリング

**AIエージェント向けガイド**

Anthropic Engineering Blog より

---

## プロンプトからコンテキストへ

従来の考え方：
- 「完璧なプロンプトを作成する」

新しいパラダイム：
- 「限られた注意資源に**何の情報を入力するか**を戦略的に選択する」

コンテキストエンジニアリングの時代へ

---

## Context Rot（コンテキスト腐食）

### 問題
コンテキストウィンドウ内のトークン数が増加すると、モデルが情報を正確に思い出す能力が**低下する**

### 原因
- モデルの「注意予算」は有限
- トークンが増えるほど、各情報への注意が分散

### 結論
**コンテキストは有限で貴重なリソース**

---

## Just-in-Time Context Retrieval

### コンセプト
事前に全データを処理せず、必要な時に必要な情報だけを動的にロード

### 実装方法
1. 軽量な識別子を保持（ファイルパス、クエリ、リンク）
2. 実行時に動的にデータをロード
3. ファイル階層や命名規則を活用

### メリット
- コンテキストウィンドウの効率的利用
- 不要な情報の読み込みを回避

---

## 長期タスク向けの戦略

3つのアプローチ：

1. **Compaction**（圧縮）
2. **Structured Note-Taking**（構造化ノート）
3. **Sub-agent Architectures**（サブエージェント）

---

## 1. Compaction（圧縮）

### 仕組み
コンテキスト限界に近づいたら：
- 内容を要約
- 新しいウィンドウで再開

### 保持するもの
- 重要な設計決定
- バグ情報

### 破棄するもの
- 冗長なツール出力

---

## 2. Structured Note-Taking

### 仕組み
エージェントがコンテキスト外の**永続的メモリ**にノートを記録

### 実例：Claude playing Pokémon
- 数千ステップにわたってゲーム進行を追跡
- 永続的なノートで状態を管理

### メリット
- 長期的な状態管理
- コンテキストウィンドウの節約

---

## 3. Sub-agent Architectures

### 仕組み
1つの大規模エージェント ❌

複数の専門化したサブエージェント ✅

### 特徴
- 各サブエージェントが焦点を絞ったタスクを処理
- 圧縮された結果のみを親エージェントに返す

### メリット
- タスクの並列化
- コンテキストの効率的利用

---

## 実装アドバイス①：システムプロンプト

### 「Right Altitude」を目指す

**避けるべき極端：**
- 硬すぎる：if-else型の厳密なロジック
- 曖昧すぎる：抽象的な指示のみ

**目指すべきバランス：**
- 具体性と柔軟性の両立

---

## 実装アドバイス②：ツール設計

### 原則
1. 機能の重複を最小化
2. トークン効率を重視

### 判断基準
「エンジニア自身が**どのツールを使うべきか**判断できなければ、AIエージェントもできない」

---

## 実装アドバイス③：例示学習

### 悪い例
全てのエッジケースを列挙する

### 良い例
典型的で**多様な例**を厳選する

### ポイント
- 質 > 量
- 代表的なパターンを示す

---

## 核心原則

> **Find the smallest set of high-signal tokens that maximize the likelihood of your desired outcome**

最小限の高シグナルトークンで、望ましい結果の可能性を最大化する

---

## まとめ

### コンテキストは有限なリソース
- Context Rotを理解する
- Just-in-Time Retrievalで効率化

### 長期タスクには戦略が必要
- Compaction、Note-Taking、Sub-agents

### 実装の鍵
- システムプロンプト：適切な抽象度
- ツール設計：明確で重複のない構成
- 例示：厳選された多様な例

---

## 参考リンク

**記事URL:**
https://www.anthropic.com/engineering/effective-context-engineering-for-ai-agents

**Anthropic公式サイト:**
https://www.anthropic.com/

---

# Thank you!

**Claude Code で生成**
2025年11月11日
