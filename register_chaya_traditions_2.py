#!/usr/bin/env python3
import os
import requests
from dotenv import load_dotenv

load_dotenv()
NOTION_TOKEN = os.getenv("NOTION_TOKEN_ORDER")
TRADITION_DB_ID = "2ab00160-1818-81ad-b8f5-fe86d2f2b78c"

traditions = [
    {
        "name": "子供に生醤油を食べさせてはいけない",
        "overview": "抵抗力のない10才位までの子供に生醤油を食べさせると、引きつけを起こす、カンの虫が強くなる",
        "details": "生醤油には酸が含まれている。子供に食べさせれば引きつけを起こす。カンの虫が強くて引きつけを起こし、頭にきた場合は脳膜炎になる。手足にきた場合は神経が麻痺して小児麻痺になる。また半身不随になる。子供に熱が出るのは生醤油を食べさせているから。大人でも生醤油は悪い",
        "tags": ["子供", "生醤油", "引きつけ", "カンの虫", "脳膜炎", "小児麻痺", "禁忌"],
        "taboo": "10才位までの子供に生醤油を食べさせると、引きつけ、脳膜炎、小児麻痺、半身不随になる"
    },
    {
        "name": "子供の名前を呼び捨てにしない",
        "overview": "子供の名前を呼び捨てにすると出世しない",
        "details": "子供の名前を呼び捨てにしないこと。出世しなくなる",
        "tags": ["子供", "名前", "呼び捨て", "出世", "禁忌"],
        "taboo": "子供の名前を呼び捨てにすると出世しない"
    },
    {
        "name": "子供を7回外に出して入れる禁忌",
        "overview": "子供を取って外へ出して人に誤ってもらい家の中に入れることを7回すれば、孫に障りが生まれる",
        "details": "子供を取って外へ出して人に誤ってもらい家の中に入れることを7回すれば、孫に障りが生まれる。このような可哀想な愚かな事はしてはいけない",
        "tags": ["子供", "7回", "孫", "障り", "禁忌"],
        "taboo": "子供を7回外に出して入れると孫に障りが生まれる"
    },
    {
        "name": "氏神様の大切さ",
        "overview": "氏神様は産土大神様と申し上げ、人が生まれる前からこの世を去った後まで見守ってくださる最も身近な神様",
        "details": "私達が住んでいる土地の神様で産土大神様。50回志を終えた私達の御先祖様が神の位に入られ家族を見守ってくださる守護神様（神の位につかれた先祖様すなわち氏神様）。男児30日目、女児33日目に氏神様へお宮参りすることで氏子としての神様の籍を戴き、生涯を守ってくださる。引っ越しする時は必ず氏神様に報告し、引っ越し先の氏神様にも挨拶すること。通学や勤務先、入院先の土地の氏神様にもお世話になっている",
        "tags": ["氏神様", "産土大神様", "守護神", "お宮参り", "引っ越し", "報告"],
        "taboo": ""
    },
    {
        "name": "蛇を殺してはいけない",
        "overview": "蛇を殺すと蛇の祟りを受ける。9月21日以降は蛇の里帰りの時期なので特に手を掛けてはいけない",
        "details": "蛇を殺すと祟りを受ける。9月21日になれば蛇は穴の中に入って冬眠の準備をする（里帰りと言う）。殺したらいけない。手を掛けたら大変なことになる",
        "tags": ["蛇", "殺生", "祟り", "禁忌", "里帰り"],
        "taboo": "蛇を殺すと祟りを受ける。特に9月21日以降は里帰りの時期なので手を掛けてはいけない"
    },
    {
        "name": "蛇の抜け殻をタンスに入れる",
        "overview": "蛇の抜け殻をタンスに入れておくと巳さんの徳をもらえる。ちぎってはダメ",
        "details": "蛇の抜け殻をタンスに入れておくと巳さんの徳をもらう。ちぎってはダメ",
        "tags": ["蛇", "抜け殻", "タンス", "徳"],
        "taboo": ""
    },
    {
        "name": "大阪分祠の春秋大祭の意味",
        "overview": "大阪分祠の年2回の春秋大祭は、日々についている悪を払うもの",
        "details": "大阪分祠の年2回春秋の大祭は、日々についている悪を払うもの。けむたいとかいろいろな事を言っているが、もったいないこと。これからは有難くお受けさせて戴き、自分の悪を払ってもらうこと",
        "tags": ["大阪分祠", "大祭", "春秋", "悪祓い"],
        "taboo": ""
    },
    {
        "name": "猫や犬の死骸を踏んだ時の清め方",
        "overview": "車で猫や犬の死骸を踏んでしまった時は、道路で塩で清めること。そのままガレージに入れてはいけない",
        "details": "車を運転する者に。猫や犬や獣の死骸を仕方なく踏んでしまった時、そのままのタイヤでガレージに乗り入れず、道路などで塩で清めることが大切。そうしないと家屋敷が穢れ、家に災難を持ち込むことになる",
        "tags": ["車", "死骸", "塩", "清め", "禁忌"],
        "taboo": "死骸を踏んだタイヤのまま家に入れると家屋敷が穢れ災難を持ち込む"
    },
    {
        "name": "大晦日・節分・毎月1日の塩清め",
        "overview": "大晦日と節分の日と毎月1日に神様のお下がりの塩で玄関、家の回り、東西南北、車庫、タイヤを清める",
        "details": "大晦日と節分の日と毎月1日に神様のお下がりの塩で玄関、家の回り、東西南北、車庫、タイヤを清めて下さい",
        "tags": ["塩", "清め", "大晦日", "節分", "毎月1日", "玄関", "車庫"],
        "taboo": ""
    },
    {
        "name": "陰徳を積むことの大切さ",
        "overview": "人を喜ばす、人を愛する、人につくすことによって陰徳を積み、孫子代々が福と幸せを授かる",
        "details": "人を喜ばす、人を愛する、人につくす事によって、自分にその何分の一かが自然に返ってくる。これが陰徳。この陰徳を多く積むことによって、孫子代々が福と幸せを授かる。ここに良い因縁を残すことになる。良い因縁も悪い因縁も四代まで続いていく",
        "tags": ["陰徳", "因縁", "孫子代々", "幸せ", "教え"],
        "taboo": ""
    },
    {
        "name": "聖徳太子（お札）の扱い方",
        "overview": "聖徳太子は神様であるから布団の下に敷いて寝ない。足元より30cm以上上に置く。お金は皆んな神様だから大事にすること",
        "details": "聖徳太子は神様であるから布団の下に敷いて寝ない事。足元より30cm以上上に置かれればいけない。お金は皆んな神様であるから大事にすること",
        "tags": ["聖徳太子", "お札", "お金", "神様", "禁忌"],
        "taboo": "聖徳太子を布団の下に敷いて寝ない。足元より30cm以上上に置く"
    },
    {
        "name": "お地蔵さんが池の水難事故を防ぐ",
        "overview": "ある池で毎年水難事故があり、教主様がお地蔵さんを建てさせたところ、小さい事故はあるが誰も亡くなる者はいなくなった",
        "details": "一昔ある池で毎年水難事故があり、教主様はお地蔵さんを建てさせた。今は小さい事故はあるが誰も亡くなる者はいなくなった。お地蔵さんが守ってくれる。古い池の所にはお地蔵さんが祭ってあるがこの為",
        "tags": ["お地蔵さん", "池", "水難事故", "守護"],
        "taboo": ""
    },
    {
        "name": "学校のテスト前の先祖様への祈り",
        "overview": "学校のテストを受ける時、毎日朝晩仏壇に手を合わせておくと先祖様が助けてくれる",
        "details": "子供が学校のテストを受ける時、毎日朝晩仏壇に手を合わせておくこと。そうしたら先祖様が助けてくれることがある。テストの前に何気なく見てた事が出てたり、忘れて思い出せなかった事がパアッと思い出せたりすることがある。分からん問題があったら目を閉じて「先祖様大神様助けて下さい」と頼む。そして目を開けると、後ろから誰かが教えてくれているようにその分からん問題が解けた",
        "tags": ["テスト", "学校", "先祖様", "祈り", "仏壇"],
        "taboo": ""
    }
]

def register_tradition(tradition):
    properties = {
        "名称": {
            "title": [{
                "type": "text",
                "text": {"content": tradition["name"]}
            }]
        },
        "概要": {
            "rich_text": [{
                "type": "text",
                "text": {"content": tradition["overview"]}
            }]
        },
        "詳細・手順": {
            "rich_text": [{
                "type": "text",
                "text": {"content": tradition["details"]}
            }]
        },
        "タグ": {
            "multi_select": [{"name": tag} for tag in tradition["tags"]]
        },
        "出典": {
            "multi_select": [{"name": "茶谷"}]
        }
    }
    
    if tradition["taboo"]:
        properties["禁忌詳細"] = {
            "rich_text": [{
                "type": "text",
                "text": {"content": tradition["taboo"]}
            }]
        }
    
    payload = {
        "parent": {"database_id": TRADITION_DB_ID},
        "properties": properties
    }
    
    headers = {
        'Authorization': f'Bearer {NOTION_TOKEN}',
        'Notion-Version': '2022-06-28',
        'Content-Type': 'application/json'
    }
    
    response = requests.post(
        'https://api.notion.com/v1/pages',
        headers=headers,
        json=payload
    )
    
    if response.status_code >= 400:
        print(f"❌ 登録失敗: {tradition['name']}")
        print(response.json())
        return False
    else:
        print(f"✅ 登録成功: {tradition['name']}")
        return True

# 全て登録
success_count = 0
for tradition in traditions:
    if register_tradition(tradition):
        success_count += 1

print(f"\n合計 {success_count}/{len(traditions)} 件の伝承を登録しました")
